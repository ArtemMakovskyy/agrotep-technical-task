# Fishmarket

**Fishmarket** — це вебзастосунок для керування продажем риби. Дає змогу додавати рибу з фотографіями, переглядати список риби, а також забезпечує базову систему авторизації через Spring Security.

---

## Особливості проєкту

1. **Кілька фотографій продукту**
   - Можна завантажувати від 1 до 3 фотографій на одну рибу.
   - Зображення зберігаються на сервері в папці `public/images/`.
   - Під час перегляду списку риби відображаються всі додані фотографії.

2. **Spring Security**
   - Створено двох користувачів:
      - `admin` / `admin` — має права адміністратора, бачить усі кнопки (створення та видалення риби).
      - `user` / `user` — звичайний користувач, не бачить кнопок керування.
   - Авторизація здійснюється через форму логіну (`/login`).
   - Доступ до CRUD-операцій обмежений ролями користувачів.

3. **База даних MySQL**
   - Використовується контейнер Docker з MySQL 8.0 (див. `docker-compose.yaml`).
   - Таблиця `fish` зберігає дані про рибу: `id`, `name`, `price`, `catch_date` та імена файлів зображень.
   - Скрипти Liquibase (`V001__create_fish_table.sql` і `V002__alter_fish_image_column.sql`) забезпечують створення та зміну таблиці без втрати даних.

4. **Валідація даних**
   - Перевіряється наявність назви риби та ціни.
   - Перевіряється, що завантажено від 1 до 3 зображень, і що вони не порожні.

5. **Обробка помилок**
   - Глобальний обробник помилок показує сторінки з зрозумілими повідомленнями у випадках:
      - Рибу не знайдено
      - Помилка під час роботи із зображеннями
      - Невірні дані

---

## Технології

- Java 17+
- Spring Boot 3.3+
- Spring Security
- Spring Data JPA (Hibernate)
- MySQL 8.0 (через Docker)
- Thymeleaf
- Bootstrap 5
- Lombok
- Liquibase

---

## Запуск проєкту

1. **Docker**
   - Запустіть контейнер MySQL:
     ```bash
     docker-compose up -d
     ```
   - Базу даних буде створено автоматично через скрипт `fishStructure.sql`.

2. **Spring Boot**
   - Збірка та запуск застосунку через Maven:
     ```bash
     mvn clean install
     mvn spring-boot:run
     ```
   - Застосунок буде доступний за адресою: `http://localhost:8080/fish`.

3. **Логін**
   - Адміністратор:
     ```
     login: admin
     password: admin
     ```
   - Звичайний користувач:
     ```
     login: user
     password: user
     ```

---

## Використання

- Перегляд списку риби: `/fish`
- Додавання риби (лише для admin): `/fish/create`
- Видалення риби (лише для admin): кнопка **«Прибрати»** поруч із кожним записом

---

## Тестування

- У проєкті реалізовано юніт-тести для `FishService` та `SecurityConfig`.
- Перевіряється:
   - Додавання риби з 1–3 зображеннями
   - Валідація даних
   - Авторизація та ролі користувачів
   - Робота із зображеннями

---

## Структура проєкту

```
src/main/java/technikal/task/fishmarket/
├── config/           # Налаштування Spring Security та Web
├── controller/       # Контролери для сторінок і логіну
├── exception/        # Обробники помилок
├── model/            # DTO та сутності
├── repository/       # JpaRepository
├── service/          # Бізнес-логіка
├── FishmarketApplication.java
src/main/resources/
├── templates/        # Шаблони Thymeleaf
├── application.properties
├── db/changelog/     # Скрипти Liquibase
├── sql/              # SQL-дамп структури БД
public/images/         # Папка для збереження фотографій риби
```